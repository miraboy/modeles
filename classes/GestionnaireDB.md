# üìö Documentation GestionnaireBD

Une classe PHP simple et puissante pour g√©rer vos bases de donn√©es MySQL avec √©l√©gance.

## üöÄ D√©marrage rapide

### Installation
```php
// Inclure la classe
require_once 'GestionnaireBD.php';

// Cr√©er une instance
$db = new GestionnaireBD(
    'localhost',        // Host
    'username',         // Utilisateur
    'password',         // Mot de passe
    'ma_base',          // Base de donn√©es
    'ma_table'          // Table √† manipuler
);
```

### Premier exemple
```php
// Ajouter un utilisateur
$db->ajouter([
    'nom' => 'Dupont',
    'email' => 'jean.dupont@email.com',
    'age' => 30
]);

// R√©cup√©rer tous les utilisateurs
$utilisateurs = $db->selectionnerTout();
```

## üîß M√©thodes principales

### ‚ûï Ajouter des donn√©es
```php
// Ajouter un enregistrement
$succes = $db->ajouter([
    'nom' => 'Martin',
    'email' => 'marie.martin@email.com',
    'age' => 25,
    'ville' => 'Paris'
]);

if ($succes) {
    echo "Utilisateur ajout√© avec succ√®s !";
}
```

### üîç R√©cup√©rer des donn√©es

#### R√©cup√©rer tous les enregistrements
```php
$tousLesUtilisateurs = $db->selectionnerTout();
```

#### R√©cup√©rer un enregistrement sp√©cifique
```php
// Avec condition simple
$utilisateur = $db->selectionnerUn('email = :email', [':email' => 'jean@email.com']);

// Avec plusieurs conditions
$utilisateur = $db->selectionnerUn(
    'age > :age AND ville = :ville', 
    [':age' => 18, ':ville' => 'Paris']
);
```

### ‚úèÔ∏è Modifier des donn√©es
```php
// Modifier un utilisateur
$db->modifier(
    ['age' => 31, 'ville' => 'Lyon'],           // Nouvelles donn√©es
    'email = :email',                            // Condition
    [':email' => 'jean.dupont@email.com']        // Param√®tres
);
```

### üóëÔ∏è Supprimer des donn√©es
```php
// Supprimer un utilisateur
$db->supprimer('id = :id', [':id' => 5]);

// Supprimer plusieurs utilisateurs
$db->supprimer('age < :age', [':age' => 18]);
```

## üîß M√©thodes utilitaires

### üìä Compter les enregistrements
```php
// Compter tous les enregistrements
$total = $db->compter();

// Compter avec condition
$adultes = $db->compter('age >= :age', [':age' => 18]);
```

### ‚úÖ V√©rifier l'existence
```php
// V√©rifier si un email existe d√©j√†
if ($db->existe('email = :email', [':email' => 'test@email.com'])) {
    echo "Cet email est d√©j√† utilis√© !";
}
```

### üîÑ Trier les donn√©es
```php
$utilisateurs = $db->selectionnerTout();

// Trier par nom (croissant)
$utilisateursTriesNom = $db->tri($utilisateurs, 'nom', 'ASC');

// Trier par √¢ge (d√©croissant)
$utilisateursTriesAge = $db->tri($utilisateurs, 'age', 'DESC');
```

### üìÑ Paginer les donn√©es
```php
$utilisateurs = $db->selectionnerTout();

// Page 1, 10 utilisateurs par page
$page1 = $db->pagination($utilisateurs, 1, 10);

// Page 2, 5 utilisateurs par page
$page2 = $db->pagination($utilisateurs, 2, 5);
```

## üéØ Requ√™tes personnalis√©es

### Ex√©cuter une requ√™te SQL
```php
// Requ√™te SELECT personnalis√©e
$resultats = $db->executerRequete(
    'SELECT nom, email FROM ma_table WHERE age BETWEEN :min AND :max',
    [':min' => 20, ':max' => 40]
);

// Requ√™te UPDATE personnalis√©e
$db->executerRequete(
    'UPDATE ma_table SET statut = :statut WHERE derniere_connexion < :date',
    [':statut' => 'inactif', ':date' => '2024-01-01']
);
```

## üìÇ Import / Export

### üì• Importer des donn√©es

#### Depuis un fichier CSV
```php
// CSV avec en-t√™tes (par d√©faut)
$db->importer('utilisateurs.csv', 'csv', true);

// CSV sans en-t√™tes
$db->importer('donnees.csv', 'csv', false);
```

#### Depuis un fichier JSON
```php
$db->importer('utilisateurs.json', 'json');
```

### üì§ Exporter des donn√©es

#### Vers un fichier CSV
```php
// Exporter toutes les colonnes
$db->exporter('export_complet.csv', 'csv');

// Exporter seulement certaines colonnes
$db->exporter('export_partiel.csv', 'csv', ['nom', 'email']);
```

#### Vers un fichier JSON
```php
$db->exporter('utilisateurs.json', 'json');
```

## üõ†Ô∏è Configuration et maintenance

### Changer de table
```php
$db->setTable('autre_table');
```

### Personnaliser le fichier de journal
```php
$db->setCheminJournal('logs/mon_journal.log');
```

### V√©rifier les erreurs
```php
$erreurs = $db->getErreurs();
if (!empty($erreurs)) {
    foreach ($erreurs as $erreur) {
        echo "[{$erreur['timestamp']}] {$erreur['message']}\n";
    }
}
```

## üí° Exemples pratiques

### Syst√®me d'authentification
```php
class AuthManager {
    private $db;
    
    public function __construct() {
        $this->db = new GestionnaireBD('localhost', 'user', 'pass', 'app', 'utilisateurs');
    }
    
    public function inscrire($nom, $email, $motDePasse) {
        // V√©rifier si l'email existe d√©j√†
        if ($this->db->existe('email = :email', [':email' => $email])) {
            return false; // Email d√©j√† utilis√©
        }
        
        // Cr√©er l'utilisateur
        return $this->db->ajouter([
            'nom' => $nom,
            'email' => $email,
            'mot_de_passe' => password_hash($motDePasse, PASSWORD_DEFAULT),
            'date_creation' => date('Y-m-d H:i:s')
        ]);
    }
    
    public function connecter($email, $motDePasse) {
        $utilisateur = $this->db->selectionnerUn('email = :email', [':email' => $email]);
        
        if ($utilisateur && password_verify($motDePasse, $utilisateur['mot_de_passe'])) {
            // Mettre √† jour la derni√®re connexion
            $this->db->modifier(
                ['derniere_connexion' => date('Y-m-d H:i:s')],
                'id = :id',
                [':id' => $utilisateur['id']]
            );
            return $utilisateur;
        }
        
        return false;
    }
}
```

### Gestion de blog
```php
class BlogManager {
    private $db;
    
    public function __construct() {
        $this->db = new GestionnaireBD('localhost', 'user', 'pass', 'blog', 'articles');
    }
    
    public function publierArticle($titre, $contenu, $auteur) {
        return $this->db->ajouter([
            'titre' => $titre,
            'contenu' => $contenu,
            'auteur' => $auteur,
            'date_publication' => date('Y-m-d H:i:s'),
            'statut' => 'publie'
        ]);
    }
    
    public function getArticlesRecents($limite = 5) {
        $articles = $this->db->executerRequete(
            'SELECT * FROM articles WHERE statut = :statut ORDER BY date_publication DESC LIMIT :limite',
            [':statut' => 'publie', ':limite' => $limite]
        );
        
        return $articles;
    }
    
    public function rechercherArticles($motCle) {
        return $this->db->executerRequete(
            'SELECT * FROM articles WHERE (titre LIKE :motcle OR contenu LIKE :motcle) AND statut = :statut',
            [':motcle' => "%{$motCle}%", ':statut' => 'publie']
        );
    }
    
    public function exporterArticles() {
        return $this->db->exporter('sauvegarde_articles.json', 'json', ['titre', 'auteur', 'date_publication']);
    }
}
```

### Syst√®me de statistiques
```php
class StatsManager {
    private $db;
    
    public function __construct() {
        $this->db = new GestionnaireBD('localhost', 'user', 'pass', 'analytics', 'visites');
    }
    
    public function enregistrerVisite($page, $ip, $userAgent) {
        return $this->db->ajouter([
            'page' => $page,
            'ip' => $ip,
            'user_agent' => $userAgent,
            'timestamp' => date('Y-m-d H:i:s')
        ]);
    }
    
    public function getStatsDuJour() {
        $aujourd_hui = date('Y-m-d');
        return [
            'visites_total' => $this->db->compter('DATE(timestamp) = :date', [':date' => $aujourd_hui]),
            'visiteurs_uniques' => $this->db->executerRequete(
                'SELECT COUNT(DISTINCT ip) as total FROM visites WHERE DATE(timestamp) = :date',
                [':date' => $aujourd_hui]
            )[0]['total'] ?? 0
        ];
    }
    
    public function getPagesPopulaires($limite = 10) {
        return $this->db->executerRequete(
            'SELECT page, COUNT(*) as visites FROM visites GROUP BY page ORDER BY visites DESC LIMIT :limite',
            [':limite' => $limite]
        );
    }
}
```

## ‚ö†Ô∏è Gestion des erreurs

### Types d'erreurs
Le GestionnaireBD g√®re automatiquement les erreurs et les journalise. Voici les principales situations :

- **Erreurs de connexion** : Probl√®mes de base de donn√©es
- **Erreurs de validation** : Donn√©es non conformes
- **Erreurs de requ√™te** : SQL invalide
- **Erreurs de fichier** : Import/Export √©chou√©

### R√©cup√©rer les erreurs
```php
// V√©rifier s'il y a eu des erreurs
$erreurs = $db->getErreurs();

if (!empty($erreurs)) {
    echo "‚ö†Ô∏è Erreurs d√©tect√©es :\n";
    foreach ($erreurs as $erreur) {
        echo "- [{$erreur['timestamp']}] {$erreur['message']}\n";
    }
}
```

### Journal des op√©rations
Toutes les op√©rations sont automatiquement journalis√©es dans le fichier `journalGBD.log` :

```
[2024-01-15 10:30:15] [INFO] [Connexion] Connexion √©tablie √† la base de donn√©es blog, table articles
[2024-01-15 10:30:20] [INFO] [Ajout] Enregistrement ajout√© dans articles
[2024-01-15 10:30:25] [WARNING] [Validation] Erreurs de validation des donn√©es : La colonne 'email_invalide' n'existe pas dans la table
[2024-01-15 10:30:30] [ERROR] [Import] Erreur lors de l'import : Le fichier n'existe pas : donnees_inexistantes.csv
```

## üîí S√©curit√©

### Requ√™tes pr√©par√©es
Toutes les requ√™tes utilisent des param√®tres pr√©par√©s pour √©viter les injections SQL :

```php
// ‚úÖ S√©curis√©
$utilisateur = $db->selectionnerUn('email = :email', [':email' => $email]);

// ‚ùå √Ä √©viter (non disponible dans cette classe)
// $utilisateur = $db->executerRequete("SELECT * FROM users WHERE email = '$email'");
```

### Validation automatique
Les donn√©es sont automatiquement valid√©es avant insertion :

```php
// Cette insertion √©chouera si :
// - Une colonne n'existe pas
// - Un type de donn√©es est incorrect
// - Une contrainte NOT NULL est viol√©e
// - La longueur maximale est d√©pass√©e
$db->ajouter([
    'nom' => 'Jean',
    'age' => 'pas_un_nombre',  // ‚ùå Erreur de type
    'email' => null            // ‚ùå Erreur si NOT NULL
]);
```

## üéØ Conseils et bonnes pratiques

### Performance
- Utilisez `existe()` plut√¥t que `selectionnerUn()` pour v√©rifier l'existence
- Sp√©cifiez les colonnes n√©cessaires dans les exports
- Utilisez la pagination pour de gros volumes de donn√©es

### Maintenance
- Consultez r√©guli√®rement le fichier de journal
- V√©rifiez les erreurs apr√®s chaque op√©ration critique
- Sauvegardez vos donn√©es avec l'export automatique

### Structure de donn√©es
- Respectez les conventions de nommage de vos colonnes
- D√©finissez correctement les contraintes NOT NULL
- Utilisez les bons types de donn√©es MySQL

---

üéâ **Vous √™tes maintenant pr√™t √† utiliser GestionnaireBD !**

Pour plus d'informations ou des questions sp√©cifiques, n'h√©sitez pas √† consulter le code source ou √† cr√©er vos propres exemples bas√©s sur cette documentation.